    value = string.charCodeAt(counter++);&#xD;&#xA;    if (value >= 0xD800 && value <= 0xDBFF && counter < length) {&#xD;&#xA;        // High surrogate, and there is a next character.&#xD;&#xA;        extra = string.charCodeAt(counter++);&#xD;&#xA;        if ((extra & 0xFC00) === 0xDC00) {&#xD;&#xA;            // Low surrogate.&#xD;&#xA;            output.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);&#xD;&#xA;        } else {&#xD;&#xA;            // unmatched surrogate; only append this code unit, in case the next&#xD;&#xA;            // code unit is the high surrogate of a surrogate pair&#xD;&#xA;            output.push(value, extra);&#xD;&#xA;            counter--;&#xD;&#xA;        }&#xD;&#xA;    } else {&#xD;&#xA;        output.push(value);&#xD;&#xA;    }