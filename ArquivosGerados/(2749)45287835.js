    USE [something]&#xD;&#xA;    GO&#xD;&#xA;    SET ANSI_NULLS ON&#xD;&#xA;    GO&#xD;&#xA;    SET QUOTED_IDENTIFIER ON&#xD;&#xA;    GO&#xD;&#xA;    ALTER PROC [dbo].[something]&#xD;&#xA;    AS&#xD;&#xA;    BEGIN&#xD;&#xA;    	SET NOCOUNT, XACT_ABORT ON;	&#xD;&#xA;    	SET TRANSACTION ISOLATION LEVEL SERIALIZABLE&#xD;&#xA;    		BEGIN TRY&#xD;&#xA;    	&#xD;&#xA;    DECLARE &#xD;&#xA;    @something int&#xD;&#xA;    DECLARE ROW_RES CURSOR FOR&#xD;&#xA;    		SELECT something FROM something&#xD;&#xA;    		&#xD;&#xA;    OPEN ROW_RES&#xD;&#xA;    FETCH NEXT FROM ROW_RES INTO&#xD;&#xA;    	@something&#xD;&#xA;    WHILE (@@fetch_status = 0) &#xD;&#xA;    BEGIN&#xD;&#xA;    IF (@something > 0)&#xD;&#xA;    	BEGIN&#xD;&#xA;    		EXEC msdb.dbo.sp_send_dbmail&#xD;&#xA;    		@profile_name = 'myprofile',&#xD;&#xA;    		@from_address = 'do_not_reply@me.com',&#xD;&#xA;    		@recipients = 'me@me.com',&#xD;&#xA;    		@copy_recipients = 'ccme@me.com',&#xD;&#xA;    		@subject = @email_subject,&#xD;&#xA;    		@body = @email_body,&#xD;&#xA;    		@body_format = 'html'&#xD;&#xA;    	END&#xD;&#xA;    FETCH NEXT FROM ROW_RES INTO&#xD;&#xA;    	@something&#xD;&#xA;    END&#xD;&#xA;    IF (@something = false )&#xD;&#xA;    	BEGIN&#xD;&#xA;    		UPDATE something SET something = (@something) WHERE something = @something&#xD;&#xA;    	END&#xD;&#xA;    ELSE IF (@something = true)&#xD;&#xA;    	BEGIN&#xD;&#xA;    INSERT INTO something (something) VALUES (@something)&#xD;&#xA;    END&#xD;&#xA;    			COMMIT TRAN&#xD;&#xA;    		END TRY&#xD;&#xA;    	BEGIN CATCH&#xD;&#xA;    		DECLARE @MESSAGE NVARCHAR(2000), @SEVERITY INT, @STATE INT&#xD;&#xA;    		--See if there is a hanging transaction&#xD;&#xA;    		IF @@TRANCOUNT > 0 ROLLBACK TRAN&#xD;&#xA;    		--Rethrow the error to the calling application		&#xD;&#xA;    		SET @MESSAGE = ERROR_MESSAGE() &#xD;&#xA;    		SET @SEVERITY = ERROR_SEVERITY() &#xD;&#xA;    		SET @STATE = ERROR_STATE()&#xD;&#xA;    		RAISERROR(@MESSAGE, @SEVERITY, @STATE)		&#xD;&#xA;    	END CATCH&#xD;&#xA;    	SET NOCOUNT OFF;&#xD;&#xA;    END&#xD;&#xA;    CLOSE ROW_RES&#xD;&#xA;    DEALLOCATE ROW_RES