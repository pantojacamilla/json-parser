    USE [dbfoo]&#xD;&#xA;    GO&#xD;&#xA;    SET ANSI_NULLS ON&#xD;&#xA;    GO&#xD;&#xA;    SET QUOTED_IDENTIFIER ON&#xD;&#xA;    GO&#xD;&#xA;    ALTER PROCEDURE [dbo].[io_sp_admin]&#xD;&#xA;    @id BIGINT = 0, @firstName VARCHAR(20),@lastName VARCHAR(20) ,@email VARCHAR(50), @birthDate DATETIME&#xD;&#xA;            &#xD;&#xA;    AS&#xD;&#xA;    BEGIN&#xD;&#xA;           -- SET NOCOUNT ON added to prevent extra result sets from&#xD;&#xA;           -- interfering with SELECT statements.&#xD;&#xA;    SET NOCOUNT ON;&#xD;&#xA;    BEGIN TRY&#xD;&#xA;    BEGIN TRANSACTION [TranAddEmp]&#xD;&#xA;    OPEN SYMMETRIC KEY io_key DECRYPTION BY CERTIFICATE foo&#xD;&#xA;    --stage1&#xD;&#xA;    DECLARE @identity BIGINT = 0 &#xD;&#xA;    INSERT INTO [dbo].[t1]&#xD;&#xA;               ([id],&#xD;&#xA;                [deleted],&#xD;&#xA;                [user_name],&#xD;&#xA;         VALUES&#xD;&#xA;               (EncryptByKey(KEY_GUID('io_key'), CONVERT(VARBINARY(100),CAST(@id AS VARCHAR(10)))),&#xD;&#xA;               0,&#xD;&#xA;               'IoAdmin'&#xD;&#xA;    SELECT @identity = @@identity &#xD;&#xA;    --satge2&#xD;&#xA;    INSERT INTO [dbo].[t2]&#xD;&#xA;               ([id]&#xD;&#xA;               ,[deleted]&#xD;&#xA;               ,[user_name]&#xD;&#xA;         VALUES&#xD;&#xA;               (@identity,&#xD;&#xA;               EncryptByKey(KEY_GUID('io_key'), CONVERT(VARBINARY(100),CAST(@ms_zehut AS VARCHAR(10)))),&#xD;&#xA;               0,&#xD;&#xA;               'IoAdmin'&#xD;&#xA;    --stage 3&#xD;&#xA;    INSERT INTO t3(&#xD;&#xA;    id,&#xD;&#xA;    lastName,&#xD;&#xA;    firstName,&#xD;&#xA;    birtdate,&#xD;&#xA;    email)&#xD;&#xA;    SELECT&#xD;&#xA;     @identity,&#xD;&#xA;     @lastName , &#xD;&#xA;     @firstName , &#xD;&#xA;    @birthDate,&#xD;&#xA;     @email &#xD;&#xA;    CLOSE ALL SYMMETRIC KEYS&#xD;&#xA;               &#xD;&#xA;    SELECT CAST(1 as BIT) as 'Status', 'Succeeded' as 'ReturnMessage'   &#xD;&#xA;    COMMIT TRANSACTION [TranAddEmp]     &#xD;&#xA;    END TRY&#xD;&#xA;    BEGIN CATCH&#xD;&#xA;     &#xD;&#xA;    SELECT CAST(0 as BIT) as 'Status', 'ADMIN - Add employee failed' as 'ReturnMessage'       &#xD;&#xA;    ROLLBACK TRANSACTION [TranAddEmp]     &#xD;&#xA;    END CATCH&#xD;&#xA;    END